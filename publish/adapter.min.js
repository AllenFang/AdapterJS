/*! adapterjs - v0.0.2 - 2014-07-22 */
(function(){function IAdapterJS(){this.PLUGIN_READY_STATE={INIT:0,READY:1},this._ICECONNECTION_STATE={STARTING:"starting",CHECKING:"checking",CONNECTED:"connected",COMPLETED:"connected",DONE:"completed",DISCONNECTED:"disconnected",FAILED:"failed",CLOSED:"closed"},this.ICEConnectionFiredStates={},this.browser={},this.pluginReadyState=this.PLUGIN_READY_STATE.INIT}this.IAdapterJS=IAdapterJS,IAdapterJS.prototype.checkIceConnectionState=function(peerID,iceConnectionState,callback,returnStateAlways){if("function"==typeof callback){peerID=peerID?peerID:"peer";var returnState=!1;this.ICEConnectionFiredStates[peerID]&&iceConnectionState!==this._ICECONNECTION_STATE.DISCONNECTED&&iceConnectionState!==this._ICECONNECTION_STATE.FAILED&&iceConnectionState!==this._ICECONNECTION_STATE.CLOSED||(this.ICEConnectionFiredStates[peerID]=[]),iceConnectionState=this._ICECONNECTION_STATE[iceConnectionState],-1===this.ICEConnectionFiredStates[peerID].indexOf(iceConnectionState)&&(this.ICEConnectionFiredStates[peerID].push(iceConnectionState),iceConnectionState===this._ICECONNECTION_STATE.CONNECTED&&setTimeout(function(){this.ICEConnectionFiredStates[peerID].push(this._ICECONNECTION_STATE.DONE),callback(this._ICECONNECTION_STATE.DONE)},1e3),returnState=!0),(returnStateAlways||returnState)&&callback(iceConnectionState)}},IAdapterJS.prototype._getBrowser=function(){var tem,agent={},na=navigator,ua=na.userAgent,M=ua.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];if(na.mozGetUserMedia?agent.mozWebRTC=!0:na.webkitGetUserMedia?agent.webkitWebRTC=!0:ua.indexOf("Safari")&&("undefined"!=typeof InstallTrigger?agent.browser="Firefox":document.documentMode?agent.browser="IE":Object.prototype.toString.call(window.HTMLElement).indexOf("Constructor")>0?agent.browser="Safari":window.opera||na.userAgent.indexOf(" OPR/")>=0?agent.browser="Opera":window.chrome&&(agent.browser="Chrome"),agent.pluginWebRTC=!0),/trident/i.test(M[1])?(tem=/\brv[ :]+(\d+)/g.exec(ua)||[],agent.browser="IE",agent.version=parseInt(tem[1]||"0",10)):"Chrome"===M[1]&&(tem=ua.match(/\bOPR\/(\d+)/),null!==tem&&(agent.browser="Opera",agent.version=parseInt(tem[1],10))),agent.browser||(agent.browser=M[1]),!agent.version)try{M=M[2]?[M[1],M[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(tem=ua.match(/version\/(\d+)/i))&&M.splice(1,1,tem[1]),agent.version=parseInt(M[1],10)}catch(err){agent.version=0}return agent.os=navigator.platform,agent.isSCTPDCSupported=agent.mozWebRTC||"Chrome"===agent.browser&&agent.version>30||"Opera"===agent.browser&&agent.version>19,agent.isRTPDCSupported="Chrome"===agent.browser&&agent.version<30&&agent.version>24,agent.isPluginSupported=!agent.isSCTPDCSupported&&!agent.isRTPDCSupported,agent},IAdapterJS.prototype.checkMediaDataChannelSettings=function(isOffer,peerBrowserAgent,callback,constraints){if("function"==typeof callback){var peerBrowserVersion,beOfferer=!1;peerBrowserAgent.indexOf("|")>-1&&(peerBrowser=peerBrowserAgent.split("|"),peerBrowserAgent=peerBrowser[0],peerBrowserVersion=parseInt(peerBrowser[1],10));var isLocalFirefox=this.browser.mozWebRTC,isLocalFirefoxInterop=this.browser.mozWebRTC&&this.browser.version>30,isPeerFirefox="Firefox"===peerBrowserAgent,isPeerFirefoxInterop="Firefox"===peerBrowserAgent&&(peerBrowserVersion?peerBrowserVersion>30:!1);if(isOffer){if(isLocalFirefox&&isPeerFirefox||isLocalFirefoxInterop)try{delete constraints.mandatory.MozDontOfferDataChannel}catch(err){}else isLocalFirefox&&!isPeerFirefox&&(constraints.mandatory.MozDontOfferDataChannel=!0);if(!isLocalFirefox)for(var prop in constraints.mandatory)constraints.mandatory.hasOwnProperty(prop)&&-1!==prop.indexOf("Moz")&&delete constraints.mandatory[prop];callback(constraints)}else isLocalFirefox||!isPeerFirefox||isPeerFirefoxInterop||(beOfferer=!0),callback(beOfferer)}},IAdapterJS.prototype.checkMediaDataChannel=function(stream,constraints){var testedOptions={audio:!1,video:!1,data:!1};constraints.audio&&stream.getAudioTracks().length>0&&(testedOptions.audio=!0),constraints.video&&stream.getVideoTracks().length>0&&(testedOptions.video=!0);var testPeer=new RTCPeerConnection;try{var dc=testPeer.createDataChannel("_");dc&&(testedOptions.data=!0)}catch(err){}return testedOptions}}).call(this),AdapterJS=new IAdapterJS,AdapterJS.browser=AdapterJS._getBrowser();var Temasys=Temasys||{};if(Temasys.WebRTCPlugin=Temasys.WebRTCPlugin||{},Temasys.WebRTCPlugin.isPluginInstalled=null,Temasys.WebRTCPlugin.defineWebRTCInterface=null,Temasys.WebRTCPlugin.pluginNeededButNotInstalledCb=null,Temasys.WebRTCPlugin.temPluginInfo={pluginId:"plugin0",type:"application/x-temwebrtcplugin",onload:"__TemWebRTCReady0"},Temasys.WebRTCPlugin.TemPageId=Math.random().toString(36).slice(2),Temasys.WebRTCPlugin.TemRTCPlugin=null,__TemWebRTCReady0=function(){arguments.callee.StaticWasInit=arguments.callee.StaticWasInit||1,1===arguments.callee.StaticWasInit&&(Temasys.isPluginReady=!0,"function"==typeof WebRTCReadyCb&&WebRTCReadyCb()),arguments.callee.StaticWasInit++},WebRTCReadyCb=function(){AdapterJS.pluginReadyState=AdapterJS.PLUGIN_READY_STATE.READY},maybeFixConfiguration=function(pcConfig){if(null!==pcConfig)for(var i=0;i<pcConfig.iceServers.length;i++)pcConfig.iceServers[i].hasOwnProperty("urls")&&(pcConfig.iceServers[i].url=pcConfig.iceServers[i].urls,delete pcConfig.iceServers[i].urls)},RTCPeerConnection=null,getUserMedia=null,attachMediaStream=null,reattachMediaStream=null,AdapterJS.browser.mozWebRTC)RTCPeerConnection=function(pcConfig,pcConstraints){return maybeFixConfiguration(pcConfig),new mozRTCPeerConnection(pcConfig,pcConstraints)},RTCSessionDescription=mozRTCSessionDescription,RTCIceCandidate=mozRTCIceCandidate,getUserMedia=navigator.mozGetUserMedia.bind(navigator),navigator.getUserMedia=getUserMedia,createIceServer=function(url,username,password){var iceServer=null,url_parts=url.split(":");if(0===url_parts[0].indexOf("stun"))iceServer={url:url};else if(0===url_parts[0].indexOf("turn"))if(AdapterJS.browser.version<27){var turn_url_parts=url.split("?");(1===turn_url_parts.length||0===turn_url_parts[1].indexOf("transport=udp"))&&(iceServer={url:turn_url_parts[0],credential:password,username:username})}else iceServer={url:url,credential:password,username:username};return iceServer},createIceServers=function(urls,username,password){var iceServers=[];for(i=0;i<urls.length;i++){var iceServer=createIceServer(urls[i],username,password);null!==iceServer&&iceServers.push(iceServer)}return iceServers},attachMediaStream=function(element,stream){return element.mozSrcObject=stream,element.play(),element},reattachMediaStream=function(to,from){return to.mozSrcObject=from.mozSrcObject,to.play(),to},MediaStream.prototype.getVideoTracks||(MediaStream.prototype.getVideoTracks=function(){return[]}),MediaStream.prototype.getAudioTracks||(MediaStream.prototype.getAudioTracks=function(){return[]}),__TemWebRTCReady0();else if(AdapterJS.browser.webkitWebRTC)createIceServer=function(url,username,password){var iceServer=null,url_parts=url.split(":");return 0===url_parts[0].indexOf("stun")?iceServer={url:url}:0===url_parts[0].indexOf("turn")&&(iceServer={url:url,credential:password,username:username}),iceServer},createIceServers=function(urls,username,password){var iceServers=[];if(AdapterJS.browser.version>=34)iceServers={urls:urls,credential:password,username:username};else for(i=0;i<urls.length;i++){var iceServer=createIceServer(urls[i],username,password);null!==iceServer&&iceServers.push(iceServer)}return iceServers},RTCPeerConnection=function(pcConfig,pcConstraints){return AdapterJS.browser.version<34&&maybeFixConfiguration(pcConfig),new webkitRTCPeerConnection(pcConfig,pcConstraints)},getUserMedia=navigator.webkitGetUserMedia.bind(navigator),navigator.getUserMedia=getUserMedia,attachMediaStream=function(element,stream){return"undefined"!=typeof element.srcObject?element.srcObject=stream:"undefined"!=typeof element.mozSrcObject?element.mozSrcObject=stream:"undefined"!=typeof element.src&&(element.src=URL.createObjectURL(stream)),element},reattachMediaStream=function(to,from){return to.src=from.src,to},__TemWebRTCReady0();else if(AdapterJS.browser.pluginWebRTC){var isFirefox="Firefox"===AdapterJS.browser.browser,isSafari="Safari"===AdapterJS.browser.browser,isChrome="Chrome"===AdapterJS.browser.browser,isIE="IE"===AdapterJS.browser.browser;Temasys.WebRTCPlugin.TemRTCPlugin=document.createElement("object"),Temasys.WebRTCPlugin.TemRTCPlugin.id=Temasys.WebRTCPlugin.temPluginInfo.pluginId,isIE?(Temasys.WebRTCPlugin.TemRTCPlugin.width="1px",Temasys.WebRTCPlugin.TemRTCPlugin.height="1px"):(Temasys.WebRTCPlugin.TemRTCPlugin.style.visibility="hidden",Temasys.WebRTCPlugin.TemRTCPlugin.width="1px",Temasys.WebRTCPlugin.TemRTCPlugin.height="1px",Temasys.WebRTCPlugin.TemRTCPlugin.type=Temasys.WebRTCPlugin.temPluginInfo.type,Temasys.WebRTCPlugin.TemRTCPlugin.innerHTML='<param name="onload" value="'+Temasys.WebRTCPlugin.temPluginInfo.onload+'"><param name="pluginId" value="'+Temasys.WebRTCPlugin.temPluginInfo.pluginId+'"><param name="windowless" value="false" /> <param name="pageId" value="'+Temasys.WebRTCPlugin.TemPageId+'">',document.getElementsByTagName("body")[0].appendChild(Temasys.WebRTCPlugin.TemRTCPlugin)),Temasys.WebRTCPlugin.TemRTCPlugin.onreadystatechange=function(state){},Temasys.WebRTCPlugin.isPluginInstalled=function(comName,plugName,installedCb,notInstalledCb){if(isChrome||isSafari||isFirefox){for(var pluginArray=navigator.plugins,i=0;i<pluginArray.length;i++)if(pluginArray[i].name.indexOf(plugName)>=0)return void installedCb();notInstalledCb()}else{if(!isIE)return;try{{new ActiveXObject(comName+"."+plugName)}}catch(e){return void notInstalledCb()}installedCb()}},Temasys.WebRTCPlugin.defineWebRTCInterface=function(){Temasys.WebRTCPlugin.isDefined=function(variable){return null!==variable&&void 0!==variable},createIceServer=function(url,username,password){var iceServer=null,url_parts=url.split(":");return 0===url_parts[0].indexOf("stun")?iceServer={url:url,hasCredentials:!1}:0===url_parts[0].indexOf("turn")&&(iceServer={url:url,hasCredentials:!0,credential:password,username:username}),iceServer},createIceServers=function(urls,username,password){for(var iceServers=[],i=0;i<urls.length;++i)iceServers.push(createIceServer(urls[i],username,password));return iceServers},RTCSessionDescription=function(info){return Temasys.WebRTCPlugin.TemRTCPlugin.ConstructSessionDescription(info.type,info.sdp)},RTCPeerConnection=function(servers,constraints){var iceServers=null;if(servers){iceServers=servers.iceServers;for(var i=0;i<iceServers.length;i++)iceServers[i].urls&&!iceServers[i].url&&(iceServers[i].url=iceServers[i].urls),iceServers[i].hasCredentials=Temasys.WebRTCPlugin.isDefined(iceServers[i].username)&&Temasys.WebRTCPlugin.isDefined(iceServers[i].credential)}var mandatory=constraints&&constraints.mandatory?constraints.mandatory:null,optional=constraints&&constraints.optional?constraints.optional:null;return Temasys.WebRTCPlugin.TemRTCPlugin.PeerConnection(Temasys.WebRTCPlugin.TemPageId,iceServers,mandatory,optional)},MediaStreamTrack={},MediaStreamTrack.getSources=function(callback){Temasys.WebRTCPlugin.TemRTCPlugin.GetSources(callback)},getUserMedia=function(constraints,successCallback,failureCallback){constraints.audio||(constraints.audio=!1),Temasys.WebRTCPlugin.TemRTCPlugin.getUserMedia(constraints,successCallback,failureCallback)},navigator.getUserMedia=getUserMedia,attachMediaStream=function(element,stream){if(stream.enableSoundTracks(!0),"audio"!==element.nodeName.toLowerCase()){var elementId=0===element.id.length?Math.random().toString(36).slice(2):element.id;if(element.isTemWebRTCPlugin&&element.isTemWebRTCPlugin()){for(var children=element.children,i=0;i!==children.length;++i)if("streamId"===children[i].name){children[i].value=stream.id;break}element.setStreamId(stream.id)}else{var frag=document.createDocumentFragment(),temp=document.createElement("div"),classHTML=element.className?'class="'+element.className+'" ':"";for(temp.innerHTML='<object id="'+elementId+'" '+classHTML+'type="application/x-temwebrtcplugin"><param name="pluginId" value="'+elementId+'" /> <param name="pageId" value="'+Temasys.WebRTCPlugin.TemPageId+'" /> <param name="windowless" value="true" /> <param name="streamId" value="'+stream.id+'" /> </object>';temp.firstChild;)frag.appendChild(temp.firstChild);var rectObject=element.getBoundingClientRect();element.parentNode.insertBefore(frag,element),frag=document.getElementById(elementId),frag.width=rectObject.width+"px",frag.height=rectObject.height+"px",element.parentNode.removeChild(element)}var newElement=document.getElementById(elementId);return newElement.onclick=element.onclick?element.onclick:function(){},newElement._TemOnClick=function(id){var arg={srcElement:document.getElementById(id)};newElement.onclick(arg)},newElement}return element},reattachMediaStream=function(to,from){for(var stream=null,children=from.children,i=0;i!==children.length;++i)if("streamId"===children[i].name){stream=Temasys.WebRTCPlugin.TemRTCPlugin.getStreamWithId(Temasys.WebRTCPlugin.TemPageId,children[i].value);break}return null!==stream?attachMediaStream(to,stream):void alert("Could not find the stream associated with this element")},RTCIceCandidate=function(candidate){return candidate.sdpMid||(candidate.sdpMid=""),Temasys.WebRTCPlugin.TemRTCPlugin.ConstructIceCandidate(candidate.sdpMid,candidate.sdpMLineIndex,candidate.candidate)}},Temasys.WebRTCPlugin.pluginNeededButNotInstalledCb=function(){alert("Your browser is not webrtc ready and Temasys plugin is not installed")},Temasys.WebRTCPlugin.isPluginInstalled("Tem","TemWebRTCPlugin",Temasys.WebRTCPlugin.defineWebRTCInterface,Temasys.WebRTCPlugin.pluginNeededButNotInstalledCb)}